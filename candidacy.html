<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apply for Candidacy - Campus e-COMELEC</title>

  <!-- Styles -->
  <link rel="stylesheet" href="candidacy.css">

  <!-- Font Awesome Icons -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />
</head>
<body>
  <!-- ✅ DO NOT TOUCH NAVIGATION (kept exactly as before) -->
  <nav>
    <div class="inner">
      <div class="logo">
        <img src="images/comelec.png" alt="e-COMELEC Logo">
        <div class="logo-text">
          <span class="university">SOUTHERN LUZON STATE UNIVERSITY LUCENA</span>
          <span class="commission">COMMISSION ON ELECTION</span>
        </div>
      </div>
      <ul>
        <li><a href="EComelec.html"><i class="fas fa-home"></i> Home</a></li>
        <li><a href="About.html"><i class="fas fa-info-circle"></i> About</a></li>
        <li><a href="vote.html"><i class="fas fa-vote-yea"></i> Vote</a></li>
        <li><a href="result.html"><i class="fas fa-chart-bar"></i> Results</a></li>
        <li><a href="contact.html"><i class="fas fa-envelope"></i> Contact</a></li>

        <!-- Profile Menu -->
        <li class="profile-menu">
          <i id="profileBtn" class="fas fa-user-circle"></i>
          <div id="profileDropdown" class="dropdown">
            <p id="userName">Loading...</p>
            <button id="logoutBtn">Logout</button>
          </div>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Hero -->
  <header class="hero-form scroll-animate">
    <div class="hero-form-inner">
      <span class="hero-tag">
        <i class="fas fa-user-tie"></i>
        Candidate Application Portal
      </span>
      <div class="hero-form-text">
        <h1>Apply for Student Government Candidacy</h1>
        <p>
          Submit your application to become a student leader and represent your fellow students
          in a fair and transparent election process.
        </p>
      </div>
      <div class="hero-badges">
        <span><i class="fas fa-shield-alt"></i> Verified Process</span>
        <span><i class="fas fa-lock"></i> Secure Records</span>
        <span><i class="fas fa-users"></i> For SLSU Lucena Students</span>
      </div>
    </div>
  </header>

  <!-- Two-column layout: Requirements + Form -->
  <section class="form-landscape scroll-animate-right">
    <!-- Left: Requirements -->
    <aside class="requirements-section">
      <div class="requirements-header">
        <h2><i class="fas fa-list-check"></i> Candidacy Requirements</h2>
        <p class="requirements-note">
          Please make sure you meet all qualifications before submitting your candidacy form.
        </p>
      </div>

      <ul class="requirements-list">
        <li><i class="fas fa-check-circle"></i> Bona fide student of SLSU Lucena Campus</li>
        <li><i class="fas fa-check-circle"></i> No existing disciplinary records</li>
        <li><i class="fas fa-check-circle"></i> Good academic standing</li>
        <li><i class="fas fa-check-circle"></i> Duly accomplished Certificate of Candidacy</li>
        <li><i class="fas fa-check-circle"></i> Recent 2x2 ID picture</li>
        <li><i class="fas fa-check-circle"></i> Endorsement from department chair or program head</li>
        <li><i class="fas fa-check-circle"></i> Signed candidate’s code of conduct</li>
        <li><i class="fas fa-check-circle"></i> Passed interview with the election committee</li>
      </ul>

      <div class="requirements-footer">
        <a href="requirement/Certificate-of-Candidacy.docx" download class="download-btn">
          <i class="fas fa-download"></i>
          Download Full Requirements (PDF)
        </a>
        <p class="requirements-hint">
          Tip: Prepare scanned copies of your documents in advance for faster processing.
        </p>
      </div>
    </aside>

    <!-- Right: Candidacy Application Form -->
    <section class="candidacy-form-modern">
      <div class="form-container">
        <!-- Step indicator -->
        <div class="form-steps">
          <div class="step active">
            <span class="step-number">1</span>
            <span class="step-label">Personal Info</span>
          </div>
          <div class="step">
            <span class="step-number">2</span>
            <span class="step-label">Position</span>
          </div>
          <div class="step">
            <span class="step-number">3</span>
            <span class="step-label">Review & Submit</span>
          </div>
        </div>

        <h2 class="form-title">Candidacy Application Form</h2>
        <p class="form-subtitle">
          Fill in the details below accurately. Submitted information will be validated
          by the Campus e-COMELEC.
        </p>

        <form class="modern-form">
          <div class="modern-form-group">
            <label for="fullname"><i class="fas fa-user"></i> Full Name</label>
            <input
              type="text"
              id="fullname"
              name="fullname"
              placeholder="Enter your full legal name"
              required
            >
          </div>

          <div class="modern-form-group two-column">
            <div>
              <label for="idnumber"><i class="fas fa-id-card"></i> Student ID</label>
              <input
                type="text"
                id="idnumber"
                name="idnumber"
                placeholder="e.g. 23-12345"
                required
              >
            </div>
            <div>
              <label for="course"><i class="fas fa-graduation-cap"></i> Course & Year</label>
              <input
                type="text"
                id="course"
                name="course"
                placeholder="e.g. BSIT - 3rd Year"
                required
              >
            </div>
          </div>

          <div class="modern-form-group">
            <label for="position"><i class="fas fa-briefcase"></i> Desired Position</label>
            <select id="position" name="position" required>
              <option value="">-- Select Position --</option>
              <option value="Senator">Senator</option>
              <option value="Governor">Governor</option>
              <option value="Vice Governor">Vice Governor</option>
              <option value="Secretary">Secretary</option>
              <option value="CH For Finance and IGP">CH For Finance and IGP</option>
              <option value="Auditor">CH For Auditor</option>
              <option value="CH For Information and Communication">CH For Information and Communication</option>
              <option value="CH For Education And Research">CH For Education And Research</option>
              <option value="BIndTech Representative">BIndTech - Representative</option>
              <option value="BTVTEd FSM Representative">BTVTEd FSM - Representative</option>
            </select>
          </div>

          <!-- Info box -->
          <div class="candidacy-rect-box" aria-label="Candidacy information box">
            <div class="info-icon">
              <i class="fas fa-info-circle"></i>
            </div>
            <div class="info-text">
              <h3>Before you submit</h3>
              <p>
                Make sure that all the information provided is true and correct. Falsification
                of records or misrepresentation may lead to disqualification from the election.
              </p>
            </div>
          </div>

          <button type="submit" class="modern-submit">
            <i class="fas fa-paper-plane"></i>
            Submit Application
          </button>

          <p class="form-footer-note">
            After submission, you will receive further instructions via your registered email.
          </p>
        </form>
      </div>
    </section>
  </section>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <p>&copy; 2025 Campus e-COMELEC. All Rights Reserved.</p>
      <div class="footer-icons">
        <a href="#"><i class="fab fa-facebook"></i> Facebook</a>
        <a href="mailto:info@slsecomelec.edu"><i class="fas fa-envelope"></i> Email</a>
        <a href="#"><i class="fas fa-map-marker-alt"></i> Location</a>
      </div>
    </div>
  </footer>

  <!-- Firebase + Logic (unchanged behavior) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBGwXduXRNtB42biPJe0KJkqzxxdz9IuqU",
      authDomain: "e-commelec.firebaseapp.com",
      databaseURL: "https://e-commelec-default-rtdb.firebaseio.com",
      projectId: "e-commelec",
      storageBucket: "e-commelec.appspot.com",
      messagingSenderId: "334086674865",
      appId: "1:334086674865:web:63766c30fd3e9a032e8590"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // Profile dropdown & user name
    const profileBtn = document.getElementById('profileBtn');
    const profileDropdown = document.getElementById('profileDropdown');
    const logoutBtn = document.getElementById('logoutBtn');
    const userNameEl = document.getElementById('userName');

    if (profileBtn) {
      profileBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        profileDropdown.classList.toggle('active');
      });
    }

    document.addEventListener('click', (e) => {
      if (
        profileDropdown &&
        !profileDropdown.contains(e.target) &&
        !profileBtn.contains(e.target)
      ) {
        profileDropdown.classList.remove('active');
      }
    });

    let currentUserEmail = localStorage.getItem("ec_userEmail");

    if (!currentUserEmail) {
      const oldUserRaw = localStorage.getItem("loggedUser");
      if (oldUserRaw) {
        try {
          const oldUser = JSON.parse(oldUserRaw);
          if (oldUser && oldUser.email) {
            currentUserEmail = oldUser.email;
          }
        } catch (e) {
          console.error("Failed to parse loggedUser:", e);
        }
      }
    }

    if (!currentUserEmail) {
      userNameEl.textContent = "Not Logged In";
    } else {
      const safeEmail = currentUserEmail.replace(/\./g, "_");
      const userRef = ref(database, "users/" + safeEmail);

      onValue(userRef, (snapshot) => {
        const user = snapshot.val();
        if (user && user.name) {
          userNameEl.textContent = user.name;
        } else {
          userNameEl.textContent = currentUserEmail;
        }
      });
    }

    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem("ec_userName");
      localStorage.removeItem("ec_userEmail");
      localStorage.removeItem("loggedUser");
      window.location.href = "login.html";
    });

    // Form submission
    document.querySelector(".modern-form").addEventListener("submit", function(e) {
      e.preventDefault();

      const fullname = document.getElementById("fullname").value;
      const idnumber = document.getElementById("idnumber").value;
      const course = document.getElementById("course").value;
      const position = document.getElementById("position").value;

      const newCandidacy = {
        fullname,
        idnumber,
        course,
        position,
        timestamp: Date.now()
      };

      push(ref(database, "candidacy"), newCandidacy)
        .then(() => {
          alert("Candidacy application submitted successfully!");
          document.querySelector(".modern-form").reset();
        })
        .catch((error) => {
          alert("Error submitting application: " + error.message);
        });
    });

    // ===== Step indicator click + animation =====
    const stepElements = document.querySelectorAll('.form-steps .step');

    stepElements.forEach((step) => {
      step.addEventListener('click', () => {
        // Change active step
        stepElements.forEach(s => s.classList.remove('active'));
        step.classList.add('active');

        // Add bump animation on the number
        const numberEl = step.querySelector('.step-number');
        if (numberEl) {
          numberEl.classList.remove('bump');   // reset
          void numberEl.offsetWidth;           // reflow to restart animation
          numberEl.classList.add('bump');      // play animation
        }

        // Optional: scroll form into view
        const formTop = document.querySelector('.candidacy-form-modern');
        if (formTop) {
          formTop.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });
  </script>

  <!-- Scroll animation helper if you use it -->
  <script src="animation.js"></script>
</body>
</html>
