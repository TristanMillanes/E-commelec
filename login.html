<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>e-COMELEC Login & Sign Up</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="login.css" />
</head>

<body>

<!-- NOTIFICATION POPUP -->
<div id="notification-container"></div>

<div class="container">

  <!-- ================= LEFT SIDE ================= -->
  <div class="left-panel">

    <!-- THREE LOGOS -->
    <div class="logo-row">
      <img src="images/main.png" class="left-logo" />
      <img src="images/comelec.png" class="left-logo" />
      <img src="images/lucena.png" class="left-logo" />
    </div>

    <h1 class="left-title">COMMISSION ON ELECTION</h1>
    <h1 class="left-title">E-COMELEC</h1>

    <p class="left-desc">
      Secure • Digital • Online Voting System<br />
      Southern Luzon State University Lucena Campus
    </p>
  </div>

  <!-- ================= RIGHT SIDE ================= -->
  <div class="right-panel">

    <div class="card">

      <!-- TABS -->
      <div class="tabs">
        <button id="loginTab" class="active">Login</button>
        <button id="signupTab">Sign Up</button>
      </div>

      <!-- LOGIN FORM -->
      <div id="loginForm" class="form active">
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="loginEmail" placeholder="Enter email" required />
        </div>

        <div class="form-group">
          <label>Password</label>
          <input type="password" id="loginPassword" placeholder="Enter password" required />
        </div>

        <button class="submit-btn" id="loginBtn">Login</button>
      </div>

      <!-- SIGNUP FORM -->
      <div id="signupForm" class="form">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" id="signupName" placeholder="Enter full name" required />
        </div>

        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="signupEmail" placeholder="Enter email" required />
        </div>

        <div class="form-group">
          <label>Password</label>
          <input type="password" id="signupPassword" placeholder="Create password" required />
        </div>

        <div class="form-group">
          <label>Confirm Password</label>
          <input type="password" id="signupConfirm" placeholder="Re-enter password" required />
        </div>

        <button class="submit-btn" id="signupBtn">Create Account</button>
      </div>

      <p class="footer">© 2025 e-COMELEC. All Rights Reserved.</p>

    </div>
  </div>

</div>

<!-- ===================================================== -->
<!-- FIREBASE SCRIPT -->
<!-- ===================================================== -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBGwXduXRNtB42biPJe0KJkqzxxdz9IuqU",
    authDomain: "e-commelec.firebaseapp.com",
    databaseURL: "https://e-commelec-default-rtdb.firebaseio.com",
    projectId: "e-commelec",
    storageBucket: "e-commelec.firebasestorage.app",
    messagingSenderId: "334086674865",
    appId: "1:334086674865:web:63766c30fd3e9a032e8590",
    measurementId: "G-9JQ5FGVVFL"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  /* ============= TAB SWITCHING ============= */
  const loginTab = document.getElementById("loginTab");
  const signupTab = document.getElementById("signupTab");

  const loginForm = document.getElementById("loginForm");
  const signupForm = document.getElementById("signupForm");

  loginTab.onclick = () => {
    loginTab.classList.add("active");
    signupTab.classList.remove("active");
    loginForm.classList.add("active");
    signupForm.classList.remove("active");
  };

  signupTab.onclick = () => {
    signupTab.classList.add("active");
    loginTab.classList.remove("active");
    signupForm.classList.add("active");
    loginForm.classList.remove("active");
  };

  /* ============= NOTIFICATIONS ============= */
  function showNotification(message, type = "success") {
    const container = document.getElementById("notification-container");
    const notif = document.createElement("div");

    notif.classList.add("notification", type);
    notif.textContent = message;

    container.appendChild(notif);

    setTimeout(() => {
      notif.style.animation = "slideOut 0.3s forwards";
      setTimeout(() => notif.remove(), 300);
    }, 2500);
  }

  /* ============= SIGN UP ============= */
  const signupBtn = document.getElementById("signupBtn");

  signupBtn.onclick = () => {
    const name = signupName.value.trim();
    const email = signupEmail.value.trim();
    const pass = signupPassword.value.trim();
    const confirm = signupConfirm.value.trim();

    if (!name || !email || !pass || !confirm)
      return showNotification("Please fill up all fields.", "error");

    if (pass !== confirm)
      return showNotification("Passwords do not match!", "error");

    const safeEmail = email.replace(/\./g, "_");

    set(ref(db, "users/" + safeEmail), {
      name,
      email,
      password: pass,
      registeredAt: new Date().toISOString()
    })
      .then(() => showNotification("Account created successfully!", "success"))
      .catch(err => showNotification(err.message, "error"));
  };

  /* ============= LOGIN ============= */
  const loginBtn = document.getElementById("loginBtn");

  loginBtn.onclick = () => {
    const email = loginEmail.value.trim();
    const pass = loginPassword.value.trim();

    if (!email || !pass)
      return showNotification("Please enter email and password.", "error");

    const safeEmail = email.replace(/\./g, "_");
    const dbRef = ref(db);

    get(child(dbRef, "users/" + safeEmail))
      .then((snapshot) => {
        if (!snapshot.exists())
          return showNotification("User not found!", "error");

        const user = snapshot.val();

        if (user.password === pass) {
          showNotification("Login successful!", "success");

          // ⭐ SAVE USER DATA FOR EComelec.html
          localStorage.setItem("ec_userName", user.name || "");
          localStorage.setItem("ec_userEmail", user.email || email);

          // ⭐ REDIRECT TO EComelec.html AFTER LOGIN
          setTimeout(() => {
            window.location.href = "EComelec.html";
          }, 1200);

        } else {
          showNotification("Incorrect password!", "error");
        }
      })
      .catch(err => showNotification(err.message, "error"));
  };
</script>

</body>
</html>
